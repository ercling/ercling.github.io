{"version":3,"sources":["webpack:///webpack/bootstrap 4ae74bc491075ddba9d3","webpack:///./src/session.js","webpack:///./src/utils.js","webpack:///./src/config.js","webpack:///./src/settings.js","webpack:///./src/Popup/index.js","webpack:///./src/actions/email.js","webpack:///./src/actions/init.js","webpack:///./src/actions/webpush.js","webpack:///./src/actions/webpushfcm.js","webpack:///./src/Popup/Popup2.js","webpack:///./src/Popup/Popup3.js","webpack:///./src/Popup/Popup4.js","webpack:///./src/index.js"],"names":["getWindowSize","e","document","documentElement","g","getElementsByTagName","width","window","innerWidth","clientWidth","height","innerHeight","clientHeight","hasOwnNestedProperty","obj","prop","parts","split","i","l","length","part","resizePopup","windowSize","$","css","arrayBufferToBase64","buffer","binary","bytes","Uint8Array","len","byteLength","String","fromCharCode","btoa","loadScript","url","loadCallback","createElement","src","type","async","onload","s","parentNode","insertBefore","Cookie","PREFIX","get","name","matches","cookie","match","RegExp","replace","decodeURIComponent","set","value","options","path","domain","Settings","subscribe","cookie_domain","location","host","expires","d","Date","setTime","getTime","toUTCString","encodeURIComponent","updatedCookie","propName","propValue","log","Session","debug","showDelay","registeredNextDelay","showedNextDelay","showedKey","resubShowedKey","showedSecondKey","registeredKey","webpushShowed","webpushShowedTTL","enteredEmail","enteredEmailTTL","settings","webpush","invalid","windowProxy","settingsLoading","settingsLoaded","settingsLoadedCb","onMessage","msg","data","action","popup","remove","console","post","email","Config","isResubExpired","reg_ts","diff","now","minSinceReg","Math","floor","resubShowedTimes","resubShowed","checkInvalid","exp","userId","apiRoot","res","Actions","init","showPopup","popupSettings","Object","assign","checkInvalidTimedOut","setTimeout","getUserInfo","callback","guestId","ajax","dataType","success","user_id","guest_id","error","loadSettings","project","keys","forEach","k","Porthole","WindowProxy","addEventListener","version","Popups","appearence_id","checkForm","formSelector","$form","$input","find","one","checkHandler","addClass","focus","val","indexOf","valid","submit","auto","custom","watcher","inFocus","on","setInterval","newImage","Image","params","push","join","undefined","delay","removePopup","showCallback","closeCallback","primaryShowed","testPopup","isEmptyObject","Popup","reloadCallback","show","initialize","initInProgress","navigator","Notification","permission","outside_click_close","trackAttempt","popup_type","trackDeny","subscribeUser","requestPermission","then","result","serviceWorker","ready","reg","pushManager","userVisibleOnly","meta","subscription","endpoint","public_key","getKey","auth_token","hash","push_user_id","date","setDate","getDate","expire","jsonp","catch","err","register","sw","installing","waiting","active","firebase","initializeApp","messagingSenderId","msgSenderId","messaging","useServiceWorker","getToken","currentToken","sendTokenToServer","setTokenSentToServer","isTokenSentToServer","localStorage","getItem","setItem","fcm_meta","token","Popup2","$body","body","$style","textContent","$bg","className","$wrapper","$iframe","scrolling","resize","pp","appendChild","style","opacity","removeChild","Popup3","upperMid","matchMedia","mid","small","transitionTop","transitionBottom","revealed","$popup","bottom","transition","Popup4","xsmall","transitionReveal","transitionHide","top","jQuery","bootstrap","Zepto","Storage","mfObject","webpushfcm","api","env","popupName","method","call","a","q","hasOwnProperty"],"mappings":"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","file":"latest.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4ae74bc491075ddba9d3","export default {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/session.js","import Settings from './settings'\nimport Session from './session'\n\nexport function getWindowSize() {\n  let e = document.documentElement\n  let g = document.getElementsByTagName('body')[0]\n  let width = window.innerWidth || e.clientWidth || g.clientWidth\n  let height = window.innerHeight || e.clientHeight || g.clientHeight\n\n  return {width, height}\n}\n\nexport function hasOwnNestedProperty(obj, prop) {\n  let parts = prop.split('.')\n  for (let i = 0, l = parts.length; i < l; i++) {\n    let part = parts[i]\n    if (obj !== null && typeof obj === 'object' && part in obj) {\n      obj = obj[part]\n    } else {\n      return false\n    }\n  }\n  return true\n}\n\nexport function resizePopup(width, height) {\n  const windowSize = getWindowSize()\n\n  if (windowSize.width >= width) {\n    $('.mf-wrapper').css({width: width + 'px'})\n  } else {\n    $('.mf-wrapper').css({width: '100%'})\n  }\n\n  if (windowSize.height >= height) {\n    $('.mf-wrapper').css({height: height + 'px'})\n  } else {\n    $('.mf-wrapper').css({height: '100%'})\n  }\n}\n\nexport function arrayBufferToBase64(buffer) {\n  let binary = ''\n  let bytes = new Uint8Array(buffer)\n  let len = bytes.byteLength\n  for (var i = 0; i < len; i++) {\n    binary += String.fromCharCode(bytes[i])\n  }\n  return window.btoa(binary)\n}\n\nexport function loadScript(url, loadCallback) {\n  let l = document.createElement('script')\n  l.src = url\n  l.type = 'text/javascript'\n  l.async = true\n  l.onload = loadCallback\n  let s = document.getElementsByTagName('script')[0]\n  s.parentNode.insertBefore(l, s)\n}\n\nexport const Cookie = {\n  PREFIX: 'mf_',\n\n  get: function (name) {\n    let matches = document.cookie.match(new RegExp(\n      '(?:^|; )' + this.PREFIX + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + '=([^;]*)'\n    ))\n    return matches ? decodeURIComponent(matches[1]) : void (0)\n  },\n\n  set: function (name, value, options) {\n    options = options || {}\n    /* Options can be:\n     expires - msec / Date obj\n     path - like /\n     domain - site.com\n     secure - true/false\n     */\n\n    // Force Defaults\n    if (process.env.NODE_ENV === 'production') {\n      if (typeof options.path === 'undefined') {\n        options.path = '/'\n      }\n      if (typeof options.domain === 'undefined') {\n        if (typeof Settings.subscribe.cookie_domain !== 'undefined') {\n          options.domain = Settings.subscribe.cookie_domain\n        } else {\n          options.domain = location.host\n        }\n      }\n    }\n\n    let expires = options.expires\n    if (typeof expires === 'number' && expires) {\n      let d = new Date()\n      d.setTime(d.getTime() + expires)\n      expires = options.expires = d.toUTCString()\n\n    } else if (expires && expires.toUTCString) {\n      options.expires = expires.toUTCString()\n\n    } else {\n      let d = new Date()\n      d.setTime(d.getTime() + 365 * 24 * 3600000)\n      expires = options.expires = d.toUTCString()\n    }\n\n    // Key and Value\n    value = encodeURIComponent(value)\n    var updatedCookie = this.PREFIX + name + '=' + value\n\n    // Options obj to string\n    for (var propName in options) {\n      updatedCookie += '; ' + propName\n      var propValue = options[propName]\n      if (propValue !== true) {\n        updatedCookie += '=' + propValue\n      }\n    }\n\n    document.cookie = updatedCookie\n  }\n}\n\nexport const log = (...args) => {\n  if (Session.debug) console.log(...args)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","export default {\n  showDelay: 10 * 1000,\n  registeredNextDelay: 168 * 3600 * 1000,\n  showedNextDelay: 168 * 3600 * 1000,\n  showedKey: 'popup_showed_v1',\n  resubShowedKey: 'popup_resub_showed_v1',\n  showedSecondKey: 'popup_showed_second_v1',\n  registeredKey: 'user_registered_v1',\n  webpushShowed: 'webpush_showed_v1',\n  webpushShowedTTL: 172800000, // 2 days\n  enteredEmail: 'email',\n  enteredEmailTTL: 5 * 60000 // 5 min\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","import Session from './session'\nimport {hasOwnNestedProperty, Cookie, loadScript, log} from './utils'\nimport Config from './config'\n\nconst settings = {subscribe: {}, webpush: {}, invalid: null}\nlet windowProxy\nSession.settingsLoading = false\nSession.settingsLoaded = false\nSession.settingsLoadedCb = () => false\n\n\nfunction onMessage(msg) {\n  if (hasOwnNestedProperty(msg, 'data.action')) {\n    switch (msg.data.action) {\n      case 'close':\n        Session.popup.remove({action: 'close'})\n        break\n\n      case 'mf-widget-loaded':\n        console.log('mf-widget-loaded')\n        windowProxy.post({email: Cookie.get(Config.enteredEmail)})\n        break\n    }\n  }\n\n  if (hasOwnNestedProperty(msg, 'data.email')) {\n    log('msg.data.email', msg.data.email)\n    Cookie.set(Config.enteredEmail, msg.data.email, {expires: Config.enteredEmailTTL})\n  }\n}\n\nconst isResubExpired = () => {\n  const reg_ts = Cookie.get('reg_ts')\n  if (!reg_ts) return null\n  const diff = Date.now() - 1000 * reg_ts\n  const minSinceReg = Math.floor(diff / 60000)\n  return minSinceReg > 5\n}\n\nconst resubShowedTimes = () => {\n  const resubShowed = Cookie.get(Config.resubShowedKey)\n  if (!resubShowed) return null\n  return +resubShowed\n}\n\nexport const checkInvalid = () => {\n  if (settings.invalid) {\n    const resubShowed = resubShowedTimes()\n    log('resubShowed:', resubShowed)\n\n    const exp = isResubExpired()\n    log('resubExpired:', exp)\n\n    if (resubShowed && resubShowed >= 2 || exp) {\n      log('🚫 checkInvalid noop. Reason:', `showed ${resubShowed} time(s) || exp: ${exp}`)\n      return\n    }\n\n    log('checkInvalid', `userId: ${Session.userId}; 📪: ${Cookie.get(Config.enteredEmail)}`)\n    if (Session.userId) {\n      $.get(`${Session.apiRoot}users/invalid/${Session.userId}`, res => {\n        log('checkInvalid done', 'unsub =', res.data)\n\n        if (res.data /* invalid email entered */) {\n          Session.Actions.init.showPopup({popupSettings: Object.assign(settings.invalid, {invalid: true})})\n        }\n      })\n    }\n  }\n}\n\nexport const checkInvalidTimedOut = (userId) => userId && setTimeout(checkInvalid, 1000)\n\nexport const getUserInfo = (callback) => {\n  log('getUserInfo')\n\n  if (Cookie.get('guest_id')) {\n    Session.guestId = Cookie.get('guest_id')\n    log('mf_guest_id', Session.guestId)\n  }\n\n  $.ajax({\n    url: `${Session.apiRoot}users/cookie`,\n    dataType: 'jsonp',\n    success({reg_ts, user_id, guest_id}) {\n      log('Tried to obtain userId', user_id)\n      if (user_id || guest_id || reg_ts) {\n        if (reg_ts) {\n          Cookie.set('reg_ts', reg_ts)\n          log('/users/cookie ->', '⏱', reg_ts)\n        }\n        if (user_id) {\n          Session.userId = user_id\n          Cookie.set('user_id', user_id)\n          log('/users/cookie ->', '👤', user_id)\n        }\n        if (guest_id) {\n          Session.guestId = guest_id\n          Cookie.set('guest_id', guest_id)\n          log('/users/cookie ->', '👽', guest_id)\n        }\n        if (callback) callback(Session.userId)\n      }\n    },\n    error() {\n      if (callback) callback(null)\n    }\n  })\n}\n\nexport const loadSettings = (callback) => {\n  Session.settingsLoading = true\n  log('settingsLoaded', Session.settingsLoaded)\n\n  if (Session.settingsLoaded) {\n    log('Session.settingsLoaded')\n    Session.settingsLoadedCb(true)\n    if (callback) callback()\n    return\n  }\n\n  $.get(`${Session.apiRoot}widget/settings/${Session.project}`, res => {\n    Object.keys(res.data).forEach(k => settings[k] = res.data[k])\n\n    if (hasOwnNestedProperty(settings, 'subscribe.version')) {\n      loadScript('https://n.mailfire.io/scripts/widgets/porthole.min.js', () => {\n        if (!windowProxy) {\n          // Create a proxy window to send to and receive messages from the iFrame\n          windowProxy = new Porthole.WindowProxy(settings.subscribe.url, 'guestFrame')\n          windowProxy.addEventListener(onMessage)\n          Session.settingsLoading = false\n          Session.settingsLoaded = true\n          Session.settingsLoadedCb(true)\n          Session.version = 2\n          if (callback) callback()\n          log('settingsLoaded', Session.settingsLoaded)\n        }\n      })\n    } else {\n      if (callback) callback()\n    }\n  })\n}\n\nexport default settings\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings.js","import Popup2 from './Popup2'\nimport Popup3 from './Popup3'\nimport Popup4 from './Popup4'\n\nconst Popups = {2: Popup2, 3: Popup3, 4: Popup4}\n\nexport default (settings) => Popups[settings.appearence_id || 2](settings)\n\n\n\n// WEBPACK FOOTER //\n// ./src/Popup/index.js","const email = {\n  checkForm(formSelector) {\n    const $form = $(formSelector)\n\n    let $input = $form.find('.emailCheck')\n    if (!$input.length) {\n      $input = $form.find('input[type:email]')\n      if (!$input.length) {\n        return false\n      }\n    }\n\n    $input = $($input[0])\n\n    $form.one('submit', checkHandler)\n\n    function invalid() {\n      $form\n        .addClass('invalid')\n      $input\n        .addClass('invalid')\n        .focus()\n    }\n\n    function checkHandler() {\n      let email = $input.val()\n\n      if (!email || email === '' || email.indexOf('@') === -1 || email.indexOf('.') === -1) {\n        invalid()\n        return false\n      }\n\n      $.post('https://api.mailfire.io/v1/email/check', {email}, (res) => {\n        if (!res.data.valid) {\n          invalid()\n          // Rebind for next check\n          $form.one('submit', checkHandler)\n        } else {\n          $form.submit()\n        }\n      })\n\n      // Disable first submit\n      return false\n    }\n  }\n}\n\nexport default email\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/email.js","import Session from '../session'\nimport {Cookie, log} from '../utils'\nimport Config from '../config'\nimport Settings, {loadSettings, getUserInfo, checkInvalid, checkInvalidTimedOut} from '../settings'\nimport Popup from '../Popup'\n\nconst init = {\n  /* should fix popup's getting out of viewport in iOS */\n  // _iOSFocusFix() {\n  //   const $html = $('html')\n  //   const $body = $('body')\n  //   const css = {\n  //     '-webkit-overflow-scrolling': 'touch',\n  //     'overflow': 'auto',\n  //     'height': '100%'\n  //   }\n  //   $body.css(css)\n  //   $html.css(css)\n  // },\n\n  auto() {\n    // Session.Actions.init._iOSFocusFix()\n    if (!Session.settingsLoading) {\n      loadSettings(() => this.subscribe())\n      getUserInfo(checkInvalidTimedOut)\n    }\n  },\n\n  custom() {\n    // Session.Actions.init._iOSFocusFix()\n    if (!Session.settingsLoading) {\n      loadSettings()\n      getUserInfo(checkInvalidTimedOut)\n    }\n  },\n\n  watcher() {\n    let inFocus = true\n    $(window).on('blur', () => inFocus = false)\n    $(window).on('focus', () => inFocus = true)\n\n    setInterval(() => {\n      if (inFocus) {\n        let newImage = new Image()\n\n        let params = ['ts=' + new Date().getTime()]\n\n        if (Session.userId) params.push('user_id=' + Session.userId)\n\n        if (Cookie.get('guest_id')) params.push('guest_id=' + Cookie.get('guest_id'))\n\n        newImage.src = `https://n.mailfire.io/online/watch/${Session.project}?${params.join('&')}`\n      }\n    }, 35 * 1000)\n  },\n\n  subscribe() {\n    if (\n      Session.userId || Cookie.get(Config.registeredKey) !== undefined\n      || (Cookie.get(Config.showedKey) !== undefined && Cookie.get(Config.showedSecondKey) !== undefined)\n    ) return\n\n    let delay\n    if (Cookie.get(Config.showedKey) !== undefined) {\n      delay = 1\n      Cookie.set(Config.showedSecondKey, 1, {expires: Config.showedNextDelay})\n    } else {\n      delay = Config.showDelay\n    }\n\n    setTimeout(() => this.showPopup({popupSettings: Settings.subscribe}), delay)\n  },\n\n  removePopup() {\n    Session.popup.remove()\n  },\n\n  showPopup({popupSettings, showCallback, closeCallback} = {}) {\n    log('showPopup')\n    const userId = Cookie.get('user_id')\n    const primaryShowed = +Cookie.get(Config.showedKey) || 0\n    const resubShowed = +Cookie.get(Config.resubShowedKey) || 0\n\n    if (!Session.testPopup) {\n      if (popupSettings && !popupSettings.invalid) {\n        if (userId || primaryShowed) {\n          log('🚫 showPopup noop. Reason:', `userId ${userId} || showed ${primaryShowed}`)\n          return\n        }\n      }\n    }\n\n    if (!$.isEmptyObject(popupSettings)) {\n      Session.popup = Popup(popupSettings)\n\n      if (closeCallback && typeof closeCallback === 'function') Session.popup.closeCallback = closeCallback\n\n      Session.popup.reloadCallback = () => {\n        log('reloadCallback')\n        if (!popupSettings.invalid /* primary subscribe popup */) {\n          setTimeout(() => getUserInfo(checkInvalid), 5000)\n          checkInvalid()\n        } else {\n          getUserInfo()\n        }\n        Cookie.set(Config.registeredKey, Date.now(), {expires: Config.registeredNextDelay})\n        Session.popup.remove()\n      }\n\n      Session.popup.show()\n      log('👁')\n\n      if (!popupSettings.invalid) {\n        Cookie.set(Config.showedKey, 1, {expires: Config.showedNextDelay})\n      }\n\n      if (popupSettings.invalid) {\n        Cookie.set(Config.resubShowedKey, resubShowed && (resubShowed + 1) || 1)\n      }\n\n      if (showCallback && typeof showCallback === 'function') showCallback()\n\n    }\n    // else {\n    //   const showPopup = () =>\n    //     Session.Actions.init.showPopup({popupSettings: Settings.subscribe, showCallback, closeCallback})\n    //\n    //   if (!Session.settingsLoaded) {\n    //     loadSettings()\n    //   } else {\n    //     showPopup()\n    //   }\n    //\n    //   Session.settingsLoadedCb = showPopup\n    // }\n  }\n}\n\nexport default init\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/init.js","import Session from '../session'\nimport Settings, {loadSettings, getUserInfo} from '../settings'\nimport {Cookie, arrayBufferToBase64, log} from '../utils'\nimport Popup from '../Popup'\nimport Config from '../config'\n\nexport default {init, auto, showPopup, subscribe}\n\nlet initialize = () => null\nlet initInProgress = false\n\nfunction init() {\n  if (initInProgress) return\n  initInProgress = true\n\n  if (!('serviceWorker' in navigator)) {\n    log('Service workers aren\\'t supported in this browser.')\n    initInProgress = false\n    return\n  }\n  loadSettings(() => {\n    initInProgress = false\n    initialize()\n  })\n}\n\nfunction auto() {\n  init()\n\n  if (initInProgress) {\n    const webpushShowed = Cookie.get(Config.webpushShowed)\n    log('webpushShowed', webpushShowed)\n    if (webpushShowed) {\n      log('bailing out...')\n      return\n    }\n\n    log('permission', Notification.permission)\n\n    if (Notification.permission === 'denied') {\n      log('bailing out...')\n      return\n    }\n\n    initialize = () => setTimeout(() => showPopup(), 3000)\n    // initialize = () => setTimeout(() => subscribe(), 3000)\n    return\n  }\n}\n\nfunction showPopup() {\n  if (initInProgress) {\n    initialize = showPopup\n    return\n  }\n\n  const {url, width, height, outside_click_close} = Settings.webpush\n  // log('url, width, height', url, width, height)\n\n  if (url && width && height) {\n    Session.popup = Popup({url, width, height, outside_click_close})\n\n    Cookie.set(Config.webpushShowed, 1, {expires: Config.webpushShowedTTL})\n    log(Config.webpushShowed, 1)\n\n    trackAttempt({popup_type: 1})\n\n    Session.popup.closeCallback = () => {\n      trackDeny({popup_type: 1})\n    }\n\n    Session.popup.reloadCallback = () => {\n      subscribe()\n      Session.popup.remove()\n    }\n\n    if ('serviceWorker' in navigator) {\n      Session.popup.show()\n    }\n  }\n}\n\nfunction trackAttempt({userId, popup_type}) {\n  $.post(`https://api.mailfire.io/v1/webpush/attempt/${Session.project}`,\n    {user_id: userId && +userId || null, popup_type},\n    () => {\n      log('attempt ok;', 'popup_type', popup_type)\n    }\n  )\n}\n\nfunction trackDeny({popup_type}) {\n  $.post(`https://api.mailfire.io/v1/webpush/deny/${Session.project}`, {popup_type}, () => {\n    log('deny ok;', 'popup_type', popup_type)\n  })\n}\n\nfunction subscribe() {\n  if (initInProgress) {\n    initialize = subscribe\n    return\n  }\n\n  log('>> Permission', Notification.permission)\n\n  if (Session.userId) {\n    if (Notification.permission === 'default') {\n      trackAttempt({userId: Session.userId, popup_type: 2})\n    }\n    subscribeUser()\n  } else {\n    getUserInfo(userId => {\n      if (Notification.permission === 'default') {\n        trackAttempt({userId, popup_type: 2})\n      }\n      subscribeUser()\n    })\n  }\n}\n\nfunction subscribeUser() {\n  Notification.requestPermission().then(function (result) {\n    log('>> Permission', result)\n\n    navigator.serviceWorker.ready.then(reg => {\n      log('serviceWorker.ready')\n\n      reg.pushManager.subscribe({userVisibleOnly: true})\n        .then(subscription => {\n          const data = {\n            meta: {\n              url: subscription.endpoint,\n              public_key: arrayBufferToBase64(subscription.getKey('p256dh')),\n              auth_token: arrayBufferToBase64(subscription.getKey('auth'))\n            }\n          }\n\n          if (Session.userId) {\n            data.user_id = +Session.userId\n          } else {\n            data.hash = Session.guestId\n          }\n\n          $.post(`https://api.mailfire.io/v1/webpush/project/${Session.project}`, data, ({data}) => {\n            const {push_user_id} = data\n            if (push_user_id) {\n              log('push_user_id', push_user_id)\n              Cookie.set('push_user_id', push_user_id)\n\n              const date = new Date()\n              date.setDate(date.getDate() + 365)\n\n              $.ajax({\n                dataType: 'jsonp',\n                url: 'https://n.mailfire.io/users/setcookie',\n                data: {\n                  'push_user_id': {\n                    value: push_user_id,\n                    expire: date.toUTCString()\n                  }\n                },\n                jsonp: 'callback',\n                success(res) {\n                  log(res)\n                }\n              })\n            }\n          })\n        })\n        .catch(err => {\n          if (Notification.permission === 'denied') {\n            log('Permission denied.', err)\n            trackDeny({popup_type: 2})\n          } else {\n            log('Unable to subscribe to push.', err)\n          }\n        })\n    })\n  })\n  .catch(() => log('FAILED'))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/webpush.js","import Session from '../session'\nimport Settings, {loadSettings, getUserInfo} from '../settings'\nimport {Cookie, log, loadScript} from '../utils'\nimport Popup from '../Popup'\nimport Config from '../config'\n\nexport default {init, auto, showPopup, subscribe}\n\nlet initialize = () => null\nlet initInProgress = false\n\nfunction init() {\n  if (initInProgress) return\n  initInProgress = true\n\n  if (!('serviceWorker' in navigator)) {\n    log(\"Service workers aren't supported in this browser.\")\n    initInProgress = false\n    return\n  }\n\n  loadScript('https://www.gstatic.com/firebasejs/4.5.0/firebase-app.js', () => {\n    loadScript('https://www.gstatic.com/firebasejs/4.5.0/firebase-messaging.js', () => {\n      navigator.serviceWorker.register(Session.sw)\n        .then(reg => {\n          if (reg.installing) {\n            console.log('Service worker installing')\n          } else if (reg.waiting) {\n            console.log('Service worker installed')\n          } else if (reg.active) {\n            console.log('Service worker active')\n          }\n\n          firebase.initializeApp({\n            messagingSenderId: Session.msgSenderId\n          })\n          Session.messaging = firebase.messaging()\n          Session.messaging.useServiceWorker(reg)\n\n          loadSettings(() => {\n            initInProgress = false\n            initialize()\n          })\n        })\n    })\n  })\n}\n\nfunction auto() {\n  init()\n\n  if (initInProgress) {\n    const webpushShowed = Cookie.get(Config.webpushShowed)\n    log('webpushShowed', webpushShowed)\n    if (webpushShowed) {\n      log('bailing out...')\n      return\n    }\n\n    log('permission', Notification.permission)\n\n    if (Notification.permission === 'denied') {\n      log('bailing out...')\n      return\n    }\n\n    // initialize = () => setTimeout(() => showPopup(), 3000)\n    initialize = () => setTimeout(() => subscribe(), 3000)\n    return\n  }\n}\n\nfunction showPopup() {\n  if (initInProgress) {\n    initialize = showPopup\n    return\n  }\n\n  const {url, width, height, outside_click_close} = Settings.webpush\n  // log('url, width, height', url, width, height)\n\n  if (url && width && height) {\n    Session.popup = Popup({url, width, height, outside_click_close})\n\n    Cookie.set(Config.webpushShowed, 1, {expires: Config.webpushShowedTTL})\n    log(Config.webpushShowed, 1)\n\n    trackAttempt({popup_type: 1})\n\n    Session.popup.closeCallback = () => {\n      trackDeny({popup_type: 1})\n    }\n\n    Session.popup.reloadCallback = () => {\n      subscribe()\n      Session.popup.remove()\n    }\n\n    if ('serviceWorker' in navigator) {\n      Session.popup.show()\n    }\n  }\n}\n\nfunction trackAttempt({userId, popup_type}) {\n  $.post(`https://api.mailfire.io/v1/webpush/attempt/${Session.project}`,\n    {user_id: userId && +userId || null, popup_type},\n    () => {\n      log('attempt ok;', 'popup_type', popup_type)\n    }\n  )\n}\n\nfunction trackDeny({popup_type}) {\n  $.post(`https://api.mailfire.io/v1/webpush/deny/${Session.project}`, {popup_type}, () => {\n    log('deny ok;', 'popup_type', popup_type)\n  })\n}\n\nfunction subscribe() {\n  if (initInProgress) {\n    initialize = subscribe\n    return\n  }\n\n  log('>> Permission', Notification.permission)\n\n  if (Session.userId) {\n    if (Notification.permission === 'default') {\n      trackAttempt({userId: Session.userId, popup_type: 2})\n    }\n    subscribeUser()\n  } else {\n    getUserInfo(userId => {\n      if (Notification.permission === 'default') {\n        trackAttempt({userId, popup_type: 2})\n      }\n      subscribeUser()\n    })\n  }\n}\n\nfunction subscribeUser() {\n  Notification.requestPermission()\n    .then(function (result) {\n      log('>> Permission', result)\n\n      navigator.serviceWorker.ready.then(reg => {\n        log('serviceWorker.ready')\n\n        Session.messaging\n          .requestPermission()\n          .then(() => {\n            Session.messaging\n              .getToken()\n              .then(currentToken => {\n                log(currentToken)\n                if (currentToken) {\n                  sendTokenToServer(currentToken)\n                  // updateUIForPushEnabled(currentToken)\n                } else {\n                  log('No Instance ID token available. Request permission to generate one.')\n                  setTokenSentToServer(false)\n                }\n              })\n              .catch(err => {\n                log('An error occurred while retrieving token.', err)\n                // updateUIForPushPermissionRequired()\n                setTokenSentToServer(false)\n              })\n          })\n          .catch(err => {\n            if (Notification.permission === 'denied') {\n              log('Permission denied.', err)\n              trackDeny({popup_type: 2})\n            }\n          })\n      })\n    })\n    .catch(() => log('FAILED'))\n}\n\nfunction isTokenSentToServer(currentToken) {\n  return window.localStorage.getItem('sentFirebaseMessagingToken') === currentToken\n}\n\nfunction setTokenSentToServer(currentToken) {\n  window.localStorage.setItem('sentFirebaseMessagingToken', currentToken || '')\n}\n\nfunction sendTokenToServer(currentToken) {\n  if (!isTokenSentToServer(currentToken)) {\n    log('Sending token to server...')\n\n    const data = {\n      fcm_meta: {\n        token: currentToken\n      }\n    }\n\n    if (Session.userId) {\n      data.user_id = +Session.userId\n    } else {\n      data.hash = Session.guestId\n    }\n\n    $.post(`https://api.mailfire.io/v1/webpush/project/${Session.project}`, data, ({data}) => {\n      const {push_user_id} = data\n      if (push_user_id) {\n        log('push_user_id', push_user_id)\n        Cookie.set('push_user_id', push_user_id)\n\n        const date = new Date()\n        date.setDate(date.getDate() + 365)\n\n        $.ajax({\n          dataType: 'jsonp',\n          url: 'https://n.mailfire.io/users/setcookie',\n          data: {\n            'push_user_id': {\n              value: push_user_id,\n              expire: date.toUTCString()\n            }\n          },\n          jsonp: 'callback',\n          success(res) {\n            log(res)\n          }\n        })\n      }\n    })\n    setTokenSentToServer(currentToken)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions/webpushfcm.js","import {resizePopup} from '../utils'\n\nconst Popup2 = function ({url, width = '100%', height = '245px', outside_click_close} = {}) {\n  const $body = document.body\n\n  const $style = document.createElement('style')\n  $style.textContent = `\n    .mf-bg {\n      width: 100%;\n      height: 100%;\n      top: 0;\n      left: 0;\n      z-index: 99999999;\n      opacity: 0;\n      position: fixed;\n      background: rgba(0,0,0,0.7);\n      transition: opacity 1s ease;\n    }\n    .mf-wrapper {\n      width: ${+width && width + 'px' || width};\n      height: ${+height && height + 'px' || height};\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      margin: auto;\n      position: absolute;\n      min-width: 320px;\n    }\n    .mf-iframe {\n      width: 100%;\n      height: 100%;\n      border: 0;\n    }\n  `\n  const $bg = document.createElement('div')\n  $bg.className = 'mf-bg'\n  const $wrapper = document.createElement('div')\n  $wrapper.className = 'mf-wrapper'\n\n  const $iframe = document.createElement('iframe')\n  $iframe.className = 'mf-iframe'\n  $iframe.src = url\n  $iframe.scrolling = 'no'\n  $iframe.name = 'guestFrame'\n\n  $(window).resize(() => resizePopup(width, height))\n\n  const pp = {\n    closeCallback: false,\n\n    show() {\n      $body.appendChild($style)\n      $body.appendChild($bg)\n      $bg.appendChild($wrapper)\n      $wrapper.appendChild($iframe)\n\n      $iframe.addEventListener('load', () => {\n        $bg.style.opacity = 1\n        $iframe.addEventListener('load', () => {\n          if (this.reloadCallback) this.reloadCallback()\n        }, false)\n      }, false)\n\n      resizePopup(width, height)\n    },\n\n    remove({action} = {}) {\n      if (this.closeCallback && action === 'close') this.closeCallback()\n      this.closeCallback = false\n      $bg.style.opacity = 0\n      setTimeout(() => {\n        if ($bg.parentNode) $body.removeChild($bg)\n      }, 1000)\n    }\n  }\n\n  if (outside_click_close) {\n    $bg.addEventListener('click', () => {\n      pp.remove({action: 'close'})\n      return false\n    }, false)\n  }\n\n  return pp\n}\n\nexport default Popup2\n\n\n\n// WEBPACK FOOTER //\n// ./src/Popup/Popup2.js","const Popup3 = function ({url, width = '100%', height = '245px'} = {}) {\n  const $body = document.body\n  const upperMid = window.matchMedia('(max-width: 1400px)')\n  const mid = window.matchMedia('(max-width: 990px)')\n  const small = window.matchMedia('(max-width: 735px)')\n\n  const transitionTop = () => 'all .5s cubic-bezier(0.06, 0.88, 0.26, 1.18)'\n  const transitionBottom = () => small.matches ? 'all 0.3s' : 'all 0.4s'\n  const revealed = () => small.matches ? '0px' : mid.matches ? '-75px' : upperMid.matches ? '-120px' : '-182px'\n\n  const $style = document.createElement('style')\n  $style.textContent = `\n    .mf-popup {\n      width: ${+width && width + 'px' || width};\n      height: ${+height && height + 'px' || height};\n      bottom: -250px;\n      left: 0;\n      right: 0;\n      margin: 0 auto;\n      z-index: 99999999;\n      position: fixed;\n    }\n    .mf-iframe {\n      width: 100%;\n      height: 100%;\n      border: 0;\n    }\n  `\n  const $popup = document.createElement('div')\n  $popup.className = 'mf-popup'\n\n  const $iframe = document.createElement('iframe')\n  $iframe.className = 'mf-iframe'\n  $iframe.src = url\n  $iframe.scrolling = 'no'\n  $iframe.name = 'guestFrame'\n\n  window.addEventListener('resize', () => {\n    $popup.style.bottom = revealed()\n  }, false)\n\n  return {\n    closeCallback: false,\n\n    show() {\n      $body.appendChild($style)\n      $body.appendChild($popup)\n      $popup.appendChild($iframe)\n\n      $iframe.addEventListener('load', () => {\n        $popup.style.bottom = revealed()\n        $popup.style.transition = transitionTop()\n        $iframe.addEventListener('load', () => {\n          if (this.reloadCallback) this.reloadCallback()\n        }, false)\n      }, false)\n    },\n\n    remove() {\n      $popup.style.bottom = '-250px'\n      $popup.style.transition = transitionBottom()\n      setTimeout(() => {\n        if (this.closeCallback) this.closeCallback()\n        this.closeCallback = false\n        if ($popup.parentNode) $body.removeChild($popup)\n        if ($style.parentNode) $body.removeChild($style)\n      }, 500)\n    }\n  }\n}\n\nexport default Popup3\n\n\n\n// WEBPACK FOOTER //\n// ./src/Popup/Popup3.js","const Popup4 = function ({url, width = '100%', height = '245px'} = {}) {\n  const $body = document.body\n  const upperMid = window.matchMedia('(max-width: 1400px)')\n  const mid = window.matchMedia('(max-width: 990px)')\n  const small = window.matchMedia('(max-width: 735px)')\n  const xsmall = window.matchMedia('(max-width: 360px)')\n\n  const transitionReveal = () => 'all .5s cubic-bezier(0.06, 0.88, 0.26, 1.18)'\n  const transitionHide = () => small.matches ? 'all 0.3s' : 'all 0.4s'\n  const revealed = () => xsmall.matches ? '0px' : small.matches ? '-15px' : mid.matches ? '-70px' : upperMid.matches ? '-125px' : '-170px'\n\n  const $style = document.createElement('style')\n  $style.textContent = `\n    .mf-popup {\n      width: ${+width && width + 'px' || width};\n      height: ${+height && height + 'px' || height};\n      top: -305px;\n      left: 0;\n      right: 0;\n      margin: 0 auto;\n      z-index: 10;\n      position: fixed;\n    }\n    .mf-iframe {\n      width: 100%;\n      height: 100%;\n      border: 0;\n    }\n  `\n  const $popup = document.createElement('div')\n  $popup.className = 'mf-popup'\n\n  const $iframe = document.createElement('iframe')\n  $iframe.className = 'mf-iframe'\n  $iframe.src = url\n  $iframe.scrolling = 'no'\n  $iframe.name = 'guestFrame'\n\n  window.addEventListener('resize', () => {\n    $popup.style.top = revealed()\n  }, false)\n\n  return {\n    closeCallback: false,\n\n    show() {\n      $body.appendChild($style)\n      $body.appendChild($popup)\n      $popup.appendChild($iframe)\n\n      $iframe.addEventListener('load', () => {\n        $popup.style.top = revealed()\n        $popup.style.transition = transitionReveal()\n        $iframe.addEventListener('load', () => {\n          if (this.reloadCallback) this.reloadCallback()\n        }, false)\n      }, false)\n    },\n\n    remove() {\n      $popup.style.top = '-305px'\n      $popup.style.transition = transitionHide()\n      setTimeout(() => {\n        if (this.closeCallback) this.closeCallback()\n        this.closeCallback = false\n        if ($popup.parentNode) $body.removeChild($popup)\n        if ($style.parentNode) $body.removeChild($style)\n      }, 500)\n    }\n  }\n}\n\nexport default Popup4\n\n\n\n// WEBPACK FOOTER //\n// ./src/Popup/Popup4.js","import Session from './session'\nimport {Cookie, loadScript} from './utils'\nimport init from './actions/init'\nimport webpush from './actions/webpush'\nimport webpushfcm from './actions/webpushfcm'\nimport email from './actions/email'\n\nif (typeof window.jQuery !== 'undefined') {\n  jQuery(() => bootstrap(jQuery))\n} else {\n  loadScript('https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js',\n  () => Zepto(() => bootstrap(Zepto)))\n}\n\nfunction bootstrap($) {\n  if (typeof Storage !== 'undefined') {\n    Session.debug = localStorage.getItem('mf-debug') === 'true'\n  }\n  const mfObject = window[window['_mf_object_name']]\n  Session.Actions = {init, webpush, webpushfcm, email}\n  Session.project = mfObject.project\n  Session.msgSenderId = mfObject.msgSenderId\n  Session.sw = mfObject.sw\n  Session.apiRoot = mfObject.api || process.env.API_ROOT\n  Session.testPopup = mfObject.testPopup || false\n  Session.env = mfObject.env || 'prod'\n  Session.popupName = mfObject.popupName\n  Session.userId = Cookie.get('user_id')\n\n  window['mf'] = function (obj, method, data) {\n    Session.Actions[obj][method].call(this, data)\n  }\n\n  for (let a in mfObject.q) {\n    if (mfObject.q.hasOwnProperty(a)) {\n      const obj = mfObject.q[a][0]\n      const method = mfObject.q[a][1]\n      const data = mfObject.q[a][2]\n      Session.Actions[obj][method](data)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}