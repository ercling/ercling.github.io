<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="/manifest.json">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
  //  (function (w, d, f) {
  //    w[f] = function () {(w[f].q = w[f].q || []).push(arguments)};
  //    w['_mf_object_name'] = f;
  //    var l = document.createElement('script');
  //    l.src = 'https://scripts.mailfire.io/build/widget/1.x/v.39.2.js';
  //    l.type = 'text/javascript';
  //    l.async = true;
  //    var s = d.getElementsByTagName('script')[0];
  //    s.parentNode.insertBefore(l, s);
  //  })(window, document, 'mf');
  //  mf.project = 27; // Your project ID
  //  mf.msgSenderId = '587960273742'; // required for webpush messages
  //
  //  mf('webpushfcm', 'auto'); // Showing popup after some time

  function handleSubscriptionError(){

  }

  function sendSubscriptionToServer(subscription) {
    const token = subscription.endpoint.split('/').pop();

    // Just for dev purposes
    Site.reg_id = token;

    post(
      pushEndpoint,
      {
        token,
        'time_zone': encodeURIComponent(getTimeZone(new Date().getTimezoneOffset()))
      }
    );
  }


  navigator.serviceWorker.register(`/yen-service-worker.js?d=2`)
    .then(registration => {
      registration.update();

      navigator.serviceWorker.ready
        .then(serviceWorkerRegistration => serviceWorkerRegistration.pushManager.getSubscription())
        .then(subscription => {
          if (!subscription) {
            navigator.serviceWorker.ready
              .then(serviceWorkerRegistration => serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly: true}))
              .then(subscription => sendSubscriptionToServer(subscription))
              .catch(handleSubscriptionError);
          } else {
            sendSubscriptionToServer(subscription);
          }
        })
        .catch(handleSubscriptionError);
    })

</script>


FCM works!
</body>
</html>